<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BTC Balance Monitor</title>
<style>
  /* üåô Background & Global Style */
  body {
    font-family: 'Poppins', system-ui, sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    color: #f5f7fa;
    min-height: 100vh;
  }
  header {
    text-align: center;
    padding: 24px 16px 12px;
  }
  h1 {
    margin: 0;
    font-weight: 700;
    font-size: 1.9rem;
    background: linear-gradient(90deg, #00f2fe, #4facfe);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .sub {
    font-size: 0.9rem;
    opacity: 0.8;
  }

  /* üßä Container */
  .container {
    max-width: 850px;
    margin: 0 auto;
    background: rgba(255,255,255,0.08);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 16px 20px 30px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.25);
  }

  /* üß≠ Controls */
  .controls {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
  }
  button {
    background: linear-gradient(90deg, #4facfe, #00f2fe);
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 8px 14px;
    cursor: pointer;
    font-weight: 600;
    transition: 0.2s;
  }
  button:hover { transform: scale(1.05); }
  .btn-ghost {
    background: transparent;
    border: 1px solid rgba(255,255,255,0.4);
    color: #fff;
  }
  select {
    background: rgba(255,255,255,0.1);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.3);
    border-radius: 6px;
    padding: 4px 8px;
  }
  .status { margin-left:auto; font-size:0.9rem; opacity:0.8; }

  /* üìã Table */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 8px;
    border-radius: 12px;
    overflow: hidden;
  }
  thead {
    background: rgba(255,255,255,0.1);
  }
  th, td {
    padding: 10px 8px;
    text-align: left;
  }
  th {
    text-transform: uppercase;
    font-size: 0.8rem;
    letter-spacing: 1px;
    color: #aee8ff;
  }
  tbody tr {
    border-bottom: 1px solid rgba(255,255,255,0.1);
    transition: background 0.3s ease;
  }
  tbody tr:hover {
    background: rgba(255,255,255,0.06);
  }
  .addr {
    font-family: monospace;
    font-size: 0.88rem;
    color: #f8f9fa;
  }
  .delta-up {
    color: #4aff9e;
    font-weight: 700;
  }
  .delta-none {
    color: #ddd;
  }
  .link {
    color: #7dd3ff;
    text-decoration: none;
  }
  .link:hover {
    text-decoration: underline;
  }

  /* ü™Ñ Notification Box */
  .notif {
    margin-top: 10px;
    padding: 10px;
    border-radius: 8px;
    background: rgba(255,255,255,0.12);
    border-left: 4px solid #00f2fe;
    display: none;
  }

  /* üì± Responsive */
  @media(max-width:700px){
    th, td { font-size: 0.8rem; }
    h1 { font-size: 1.5rem; }
  }
</style>
</head>
<body>

<header>
  <h1>BTC Balance Monitor</h1>
  <div class="sub">Pantau saldo alamat Bitcoin Anda secara real-time</div>
</header>

<div class="container">
  <div class="controls">
    <button id="refreshBtn">üîÑ Refresh Sekarang</button>
    <button class="btn-ghost" id="togglePolling">‚è∏ Jeda</button>
    <label>Interval:
      <select id="intervalSelect">
        <option value="30">30s</option>
        <option value="60" selected>60s</option>
        <option value="120">120s</option>
        <option value="300">5m</option>
      </select>
    </label>
    <div class="status">Terakhir update: <span id="lastUpdated">-</span></div>
  </div>

  <div class="notif" id="notifBox"></div>

  <table id="balancesTable">
    <thead>
      <tr>
        <th>No</th>
        <th>Address</th>
        <th>Saldo (BTC)</th>
        <th>Delta</th>
        <th>Explorer</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<script>
(() => {
  const ADDRESSES = [
    "bc1qzw8gr3rpr538ahlhycdgeaj634pkn8dvunqxr8",
    "1BgGZ9tcN4rm9KBzDn7KprQz87SZ26SAMH",
    "1LagHJk2FyCV2VzrNHVqg3gYG4TSYwDV4m",
    "1cMh228HTCiwS8ZsaakH8A8wze1JR5ZsP"
  ];
  const API_BASE = "https://blockstream.info/api";
  const STORAGE_KEY = "btc_balance_table_v2";

  const tableBody = document.getElementById("tableBody");
  const refreshBtn = document.getElementById("refreshBtn");
  const togglePollingBtn = document.getElementById("togglePolling");
  const intervalSelect = document.getElementById("intervalSelect");
  const lastUpdated = document.getElementById("lastUpdated");
  const notifBox = document.getElementById("notifBox");

  let polling = true;
  let pollTimer = null;

  const satsToBtc = s => (s / 100000000).toFixed(8);
  const explorer = a => `https://blockstream.info/address/${a}`;

  const loadState = () => JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
  const saveState = s => localStorage.setItem(STORAGE_KEY, JSON.stringify(s));

  const notify = msg => {
    notifBox.style.display = "block";
    notifBox.textContent = msg;
    setTimeout(() => notifBox.style.display = "none", 7000);
  };

  const browserNotify = (title, msg) => {
    if (!("Notification" in window)) return;
    if (Notification.permission === "granted") {
      new Notification(title, { body: msg });
    } else if (Notification.permission !== "denied") {
      Notification.requestPermission().then(p => {
        if (p === "granted") new Notification(title, { body: msg });
      });
    }
  };

  async function getBalance(addr){
    const r = await fetch(`${API_BASE}/address/${addr}`);
    if(!r.ok) throw new Error("Gagal fetch");
    const j = await r.json();
    const cs = j.chain_stats || {};
    return cs.funded_txo_sum - cs.spent_txo_sum;
  }

  async function update(){
    refreshBtn.disabled = true;
    const oldState = loadState();
    const newState = {};
    tableBody.innerHTML = "";

    let i=1;
    for(const addr of ADDRESSES){
      let sats=0, delta="‚Äî", deltaClass="delta-none";
      try{
        sats = await getBalance(addr);
        const prev = oldState[addr] || 0;
        newState[addr] = sats;
        const diff = sats - prev;
        if(diff>0){
          delta = "+" + satsToBtc(diff);
          deltaClass = "delta-up";
          notify(`BTC Masuk ke ${addr}: +${satsToBtc(diff)} BTC`);
          browserNotify("BTC Masuk üöÄ", `${addr}\n+${satsToBtc(diff)} BTC`);
        } else if(diff<0){
          delta = satsToBtc(diff);
        } else if(prev===0){
          delta="(init)";
        } else {
          delta="0.00000000";
        }
      } catch(e){
        delta = "error";
      }

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${i++}</td>
        <td class="addr">${addr}</td>
        <td>${satsToBtc(sats)}</td>
        <td class="${deltaClass}">${delta}</td>
        <td><a class="link" href="${explorer(addr)}" target="_blank">View</a></td>
      `;
      tableBody.appendChild(row);
    }
    lastUpdated.textContent = new Date().toLocaleTimeString();
    saveState(newState);
    refreshBtn.disabled = false;
  }

  function startPoll(){
    stopPoll();
    const sec = Number(intervalSelect.value);
    pollTimer = setInterval(()=>{ if(polling) update(); }, sec*1000);
    polling = true;
    togglePollingBtn.textContent = "‚è∏ Jeda";
    update();
  }

  function stopPoll(){
    clearInterval(pollTimer);
    polling=false;
    togglePollingBtn.textContent="‚ñ∂Ô∏è Lanjut";
  }

  refreshBtn.onclick = ()=>update();
  togglePollingBtn.onclick = ()=>polling ? stopPoll() : startPoll();
  intervalSelect.onchange = ()=>startPoll();

  if("Notification" in window) Notification.requestPermission();
  startPoll();
})();
</script>
</body>
</html>
